#!/bin/bash
upgrade() { echo $1; exit; }
notgrep() { grep "$@" && return 1 || return 0; }

set -x -e -o pipefail

apt update 2>&1 |
	grep -q "All packages are up to date." ||
	upgrade OS

find /go/src -type d -name .git -print0 |
	xargs -0 -P64 -I{} git --git-dir {} --bare fetch --dry-run 2>&1 |
	notgrep -q . ||
	upgrade GO
